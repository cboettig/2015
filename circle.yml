general:
  branches:
    only: 
      - master

machine:
  services:
    - docker

test:
  override:
    - docker create --name cache -v /data/_cache cboettig/cache && docker run --volumes-from cache -v $(pwd):/data cboettig/2015 Rscript -e 'servr::jekyll(script="_build/build.R", serve=FALSE)'

deployment:
  production:
    branch: master
    commands:
      - docker run -ti -v $(pwd):/data -e GH_TOKEN=$GH_TOKEN --entrypoint "/data/_build/deploy.sh" cboettig/2015 > /dev/null

# Note: This doesn't update the cache itself, to help avoid caching any errors
# Run _build/local.sh to update the cache
